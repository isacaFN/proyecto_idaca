let rutCliente,url,filas=0,arrayproductos=[];function iniciarapp(){productos()}function productos(){url="http://localhost/proyecto_idaca/public/api/productos",consultarAPI(url)}function buscar(){rutCliente=document.getElementById("rut").value.trim(),/^[0-9]+$/.test(rutCliente)?(url="http://localhost/proyecto_idaca/public/api/clientes",consultarAPI(url)):alert("El RUT solo debe contener nÃºmeros.")}async function consultarAPI(e){try{const t=await fetch(e),n=await t.json();e.includes("clientes")&&buscarCliente(n),e.includes("productos")&&(arrayproductos=n,autocompletar(arrayproductos))}catch(e){console.log(e)}}function autocompletar(e){document.querySelectorAll(".nombreProducto").forEach((function(t){const n=document.createElement("div");n.classList.add("sugerencias"),t.parentElement.appendChild(n),t.addEventListener("input",(function(o){const c=t.value.toLowerCase();n.innerHTML="";const r=e.filter((e=>"string"==typeof e.nomprod&&e.nomprod.toLowerCase().includes(c)));r.length>0?(n.style.display="block",r.forEach((o=>{const c=document.createElement("div");c.classList.add("sugerencia"),c.textContent=o.nomprod,c.addEventListener("click",(function(){t.value=o.nomprod,n.innerHTML="",n.style.display="none";const c=t.parentElement.parentElement;c&&e.forEach((e=>{if(o.nomprod===e.nomprod){c.dataset.idproducto=e.codproducto;const t=document.getElementById(c.id);t.querySelector(".codProducto").value=e.codproducto;t.querySelector(".precioProducto").value=e.precio;const n=t.querySelector(".cantidadProducto");n.addEventListener("click",(function(e){n.contains(e.target)?console.log("dentro del input"):console.log("fuera del input")}))}}))})),n.appendChild(c)}))):n.style.display="none"})),document.addEventListener("click",(function(e){t.contains(e.target)||n.contains(e.target)||(n.innerHTML="",n.style.display="none")}))}))}function buscarCliente(e){e.forEach((e=>{const{dni:t,nombre:n}=e;t===rutCliente&&mostrar(t,n)}))}function mostrar(e,t){for(;nombreCliente.firstChild;)nombreCliente.removeChild(nombreCliente.firstChild);const n=document.createElement("LABEL");n.textContent="Nombre cliente:";const o=document.createElement("INPUT");o.type="text",o.classList.add("cliente"),o.value=t,nombreCliente.appendChild(n),nombreCliente.appendChild(o),document.getElementById("rut").value=e}function agregarlinea(){filas++;const e=document.createElement("input"),t=document.createElement("TD");e.id="codproducto"+filas,e.classList.add("codProducto"),t.appendChild(e);const n=document.createElement("TD"),o=document.createElement("input");o.id="nombreProducto"+filas,o.classList.add("nombreProducto"),n.appendChild(o);const c=document.createElement("TD"),r=document.createElement("input");r.id="cantidadProducto"+filas,r.classList.add("cantidadProducto"),r.type="number",c.appendChild(r);const d=document.createElement("TD"),a=document.createElement("input");a.id="precioProducto"+filas,a.classList.add("precioProducto"),a.setAttribute("readonly","true"),d.appendChild(a);const l=document.createElement("TD"),i=document.createElement("input");i.id="subtotalProducto"+filas,i.setAttribute("readonly","true"),l.appendChild(i);const u=document.createElement("TR");if(u.id="trVenta"+filas,u.appendChild(t),u.appendChild(n),u.appendChild(c),u.appendChild(d),u.appendChild(l),document.getElementById("producto").appendChild(u),document.querySelectorAll(".limpiar").forEach((function(e){e.innerHTML=iconoLimpiar})),2==producto.children.length){document.querySelector(".ocultar").style.display="block"}if(1==producto.children.length){document.querySelector(".ocultar").style.display="none"}autocompletar(arrayproductos)}function eliminarlinea(){if(filas--,producto.children.length>1){document.getElementById("producto").lastChild.remove()}if(1==producto.children.length){document.querySelector(".ocultar").style.display="none"}autocompletar(arrayproductos)}document.addEventListener("DOMContentLoaded",(function(){iniciarapp()})),window.buscar=buscar,window.agregarlinea=agregarlinea,window.eliminarlinea=eliminarlinea;